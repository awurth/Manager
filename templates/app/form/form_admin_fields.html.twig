{% extends '@SonataDoctrineORMAdmin/Form/form_admin_fields.html.twig' %}

{% block form_row %}
  {% set show_label = show_label ?? true %}
  <div class="form-group{% if errors|length > 0 %} has-error{% endif %}" id="sonata-ba-field-container-{{ id }}">
    {% if sonata_admin.field_description.options is defined %}
      {% set label = sonata_admin.field_description.options.name|default(label)  %}
    {% endif %}

    {% set div_class = 'sonata-ba-field' %}

    {% if label is same as(false) %}
      {% set div_class = div_class ~ ' sonata-collection-row-without-label' %}
    {% endif %}

    {% if sonata_admin is defined and sonata_admin.options['form_type'] == 'horizontal' %}
      {# Add an offset if no label or is a checkbox/radio #}
      {% if form.vars.checked is defined %}
        {% if 'collection' in form.parent.vars.block_prefixes %}
          {% set div_class = div_class ~ ' col-sm-12' %}
        {% else %}
          {% set div_class = div_class ~ ' col-sm-9 col-sm-offset-3' %}
        {% endif %}
      {% elseif label is same as(false) %}
        {% set div_class = div_class ~ ' col-sm-12' %}
      {% else %}
        {% set div_class = div_class ~ ' col-sm-9' %}
      {% endif %}
    {% endif %}

    {% if show_label %}
      {{ form_label(form, label|default(null)) }}
    {% endif %}

    {% if sonata_admin is defined and sonata_admin_enabled %}
      {% set div_class = div_class ~ ' sonata-ba-field-' ~ sonata_admin.edit ~ '-' ~ sonata_admin.inline %}
    {% endif %}

    {% if errors|length > 0 %}
      {% set div_class = div_class ~ ' sonata-ba-field-error' %}
    {% endif %}

    <div class="{{ div_class }}">
      {{ form_widget(form, {'horizontal': false, 'horizontal_input_wrapper_class': ''}) }} {# {'horizontal': false, 'horizontal_input_wrapper_class': ''} needed to avoid MopaBootstrapBundle messing with the DOM #}

      {% if errors|length > 0 %}
        <div class="help-block sonata-ba-field-error-messages">
          {{ form_errors(form) }}
        </div>
      {% endif %}

      {% if sonata_admin is defined and sonata_admin_enabled and sonata_admin.field_description.help|default(false) %}
        <span class="help-block sonata-ba-field-help">{{ sonata_admin.field_description.help|trans({}, sonata_admin.field_description.translationDomain ?: admin.translationDomain)|raw }}</span>
      {% endif %}
    </div>
  </div>
{% endblock form_row %}

{%- block button_link_widget -%}
  {%- set attr = attr|merge({class: (attr.class|default('') ~ ' btn sonata-ba-action')|trim}) -%}
  {%- if disabled -%}
    {%- set attr = attr|merge({class: (attr.class|default('') ~ ' disabled')|trim}) -%}
  {%- endif -%}
  <a {{ block('attributes') }}>{{ value ? value|trans({}, translation_domain) : label|trans({}, translation_domain) }}</a>
{%- endblock -%}

{%- block html_text_widget -%}
  {%- set attr = attr|merge({class: (attr.class|default('') ~ ' html-text-field')|trim}) -%}
  <span {{ block('attributes') }}>{{ value|raw }}</span>
{%- endblock html_text_widget -%}
